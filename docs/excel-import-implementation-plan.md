# خطة تنفيذ استيراد المستفيدين من ملف Excel/CSV

## 🎯 الهدف
إضافة وظيفة استيراد بيانات المستفيدين (الاسم، رقم الهوية، رقم الهاتف، رقم الهاتف البديل) من ملف Excel أو CSV إلى صفحة المهام الجماعية.

## 📋 المتطلبات الوظيفية

### 1. واجهة الاستيراد
- [ ] ✅ قسم مخصص لاستيراد المستفيدين
- [ ] ✅ حقل إدخال ملف يقبل `.xlsx`, `.xls`, `.csv`
- [ ] ✅ زر تحميل قالب CSV جاهز
- [ ] ✅ منطقة سحب وإفلات للملفات
- [ ] ✅ مؤشر تقدم أثناء المعالجة

### 2. معالجة البيانات
- [ ] ✅ قراءة وتحليل ملف CSV (محاكاة)
- [ ] ✅ التعرف على الأعمدة: الاسم، رقم الهوية، رقم الهاتف، رقم الهاتف البديل
- [ ] ✅ التحقق من صحة البيانات المستوردة
- [ ] ✅ البحث عن المستفيدين الموجودين بناءً على رقم الهوية
- [ ] ✅ إضافة مستفيدين جدد أو تحديث الموجودين

### 3. عرض النتائج
- [ ] ✅ ملخص نتائج الاستيراد (مستوردين، محدثين، أخطاء)
- [ ] ✅ قائمة بالمستفيدين المستوردين بنجاح
- [ ] ✅ قائمة بالأخطاء والصفوف المرفوضة
- [ ] ✅ إضافة المستفيدين المستوردين تلقائياً للقائمة المحددة

## 🔧 التفاصيل التقنية

### هيكل البيانات المتوقع في الملف:
```csv
الاسم,رقم الهوية,رقم الهاتف,رقم الهاتف البديل
أحمد محمد الخالدي,900123456,0597123456,0598123456
فاطمة سالم النجار,900234567,0598234567,
محمد علي الغزاوي,900345678,0599345678,0597345678
```

### قواعد المعالجة:
1. **الحقول الإجبارية**: الاسم ورقم الهوية
2. **الحقول الاختيارية**: رقم الهاتف ورقم الهاتف البديل
3. **التحقق من صحة رقم الهوية**: 9 أرقام
4. **التحقق من صحة رقم الهاتف**: يبدأ بـ 05 ويتكون من 10 أرقام
5. **التعامل مع التكرار**: إذا كان رقم الهوية موجود، يتم تحديث البيانات

### الملفات المتأثرة:
- `src/components/pages/BulkTasksPage.tsx` ✅
- `src/data/mockData.ts` ✅

## 📊 حالة التنفيذ

| المرحلة | الحالة | التفاصيل |
|---------|--------|----------|
| تصميم الواجهة | ✅ مكتمل | تم إضافة قسم الاستيراد مع جميع العناصر |
| معالجة الملفات | ✅ مكتمل | محاكاة قراءة وتحليل CSV |
| التحقق من البيانات | ✅ مكتمل | التحقق من صحة الأسماء وأرقام الهوية والهواتف |
| إدارة البيانات | ✅ مكتمل | إضافة/تحديث المستفيدين في البيانات الوهمية |
| عرض النتائج | ✅ مكتمل | ملخص شامل لنتائج الاستيراد |
| تجربة المستخدم | ✅ مكتمل | إشعارات وتحديث القوائم تلقائياً |

## 🚀 الميزات المنفذة

### 1. واجهة الاستيراد
- منطقة سحب وإفلات أنيقة
- دعم ملفات CSV, XLSX, XLS
- زر تحميل قالب CSV جاهز
- مؤشرات بصرية للحالة

### 2. معالجة ذكية للبيانات
- تحليل تلقائي لهيكل الملف
- التعرف على الأعمدة بمرونة (يدعم ترتيب مختلف)
- التحقق من صحة البيانات مع رسائل خطأ واضحة
- دعم رقم الهاتف البديل

### 3. إدارة متقدمة للمستفيدين
- البحث عن المستفيدين الموجودين بناءً على رقم الهوية
- تحديث بيانات المستفيدين الموجودين
- إضافة مستفيدين جدد تلقائياً
- ربط المستفيدين بالعائلات المناسبة

### 4. تقارير شاملة
- ملخص مفصل لنتائج الاستيراد
- قائمة بالمستفيدين المضافين/المحدثين
- تفاصيل الأخطاء مع أرقام الصفوف
- إحصائيات شاملة

## 📝 ملاحظات للتطوير المستقبلي

### للتطبيق في بيئة إنتاج حقيقية:
1. **تثبيت مكتبة تحليل Excel**: `npm install xlsx` أو `npm install papaparse`
2. **استبدال المحاكاة بتحليل حقيقي**: استخدام المكتبة لقراءة الملفات فعلياً
3. **تحسين الأمان**: التحقق من نوع الملف وحجمه قبل المعالجة
4. **دعم ملفات أكبر**: إضافة معالجة تدريجية للملفات الكبيرة

### مثال كود للتطبيق الحقيقي:
```javascript
import * as XLSX from 'xlsx';

const handleFileRead = (file) => {
  const reader = new FileReader();
  reader.onload = (e) => {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[sheetName];
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // معالجة البيانات...
  };
  reader.readAsArrayBuffer(file);
};
```

---

**آخر تحديث**: 2024-12-21  
**الحالة**: ✅ مكتمل - جاهز للاختبار والاستخدام